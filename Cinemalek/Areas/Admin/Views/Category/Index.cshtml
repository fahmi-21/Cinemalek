@model CategoriesVM

<div class="container">

    <!-- Header -->
    <div class="row mb-3 align-items-center my-3">
        <div class="col-md-6">
            <h2 class="display-6">Categories</h2>
        </div>

        <div class="col-md-6 text-md-end text-start mt-2 mt-md-0">
            <a asp-area="Admin" asp-controller="Category" asp-action="Create"
               class="btn btn-success">
                + Add Category
            </a>
        </div>
    </div>

    <!-- Filter -->
    <section class="py-3 filter-bar">
        <form method="get" asp-action="Index">
            <div class="row bg-light p-2 rounded">

                <!-- Name filter -->
                <div class="col-md-4 mb-2">
                    <input type="text" class="form-control"
                           name="name"
                           placeholder="Category Name..."
                           value="@Model.CategoryName" />
                </div>

                <!-- Status filter -->
                <div class="col-md-4 mb-2">
                    <select class="form-select" name="status">
                        <option value="">All Status</option>
                        <option value="true" selected="@(Model.Status == true)">
                            Available
                        </option>
                        <option value="false" selected="@(Model.Status == false)">
                            Not Available
                        </option>
                    </select>
                </div>

                <div class="col-md-4 text-md-end">
                    <button class="btn btn-primary">Filter</button>
                </div>
            </div>
        </form>
    </section>

    <!-- Table -->
    <div class="row mt-3">
        <div class="col-12">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Movies</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Categories)
                    {
                        <tr>
                            <td>@item.Id</td>
                            <td>@item.Name</td>
                            <td>
                                <span class="badge @(item.Status ? "text-bg-success" : "text-bg-danger")">
                                    @(item.Status ? "Available" : "Not Available")
                                </span>
                            </td>
                            @* <td>
                                @(Model.MoviesCount.ContainsKey(item.Id)
                                    ? Model.MoviesCount[item.Id]
                                    : 0)
                            </td> *@
                            <td>
                                <a asp-area="Admin" asp-controller="Category"
                                   asp-action="Edite" asp-route-id="@item.Id"
                                   class="btn btn-sm btn-warning">
                                    <i class="fa-solid fa-pen"></i>
                                </a>

                                <a asp-area="Admin" asp-controller="Category"
                                   asp-action="Delete" asp-route-id="@item.Id"
                                   class="btn btn-sm btn-danger btn-delete">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="row">
        <div class="col-12 d-flex justify-content-center">
            <ul class="pagination">

                @if (Model.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link"
                           href="@Url.Action("Index", new {
                               page = Model.CurrentPage - 1,
                               name = Model.CategoryName,
                               status = Model.Status
                           })">
                            Previous
                        </a>
                    </li>
                }

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                        <a class="page-link"
                           href="@Url.Action("Index", new {
                               page = i,
                               name = Model.CategoryName,
                               status = Model.Status
                           })">
                            @i
                        </a>
                    </li>
                }

                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link"
                           href="@Url.Action("Index", new {
                               page = Model.CurrentPage + 1,
                               name = Model.CategoryName,
                               status = Model.Status
                           })">
                            Next
                        </a>
                    </li>
                }

            </ul>
        </div>
    </div>

</div>


<!-- SweetAlert Delete Confirmation -->
<script>
    document.querySelectorAll(".btn-delete").forEach(btn => {
        btn.addEventListener("click", function(e) {
            e.preventDefault();
            const url = this.getAttribute("href");

            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url;
                }
            });
        });
    });
</script>


